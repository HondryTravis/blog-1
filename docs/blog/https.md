# Https 流程

https 流程示意图

![https流程图](https.png)

## 流程分析

- 1、客户端请求 https 链接，并发送自己支持的一套加密规则给服务器。
- 2、服务器需要安装好证书（其实就是一对公钥和私钥）。
- 3、服务端返回一组加密组件和通过 hash 算法签名的数字证书。
- 4、客户端验证证书。
  - 使用 hash 检查证书是否被篡改。
  - 验证失败，弹出提示，证书存在问题，拒绝请求。
  - 验证成功，生成随机值。
- 5、使用证书公钥将随机值加密后传给服务端。
- 6、服务端用私钥解密消息内容，获得随机值。
- 7、服务端通过随机值加密传输内容，发送给客户端。
- 8、客户端用随机值解密，获取内容。

## hash 检测

![https流程图](https-hash1.png)

![https流程图](https-hash2.png)

## https 为什么安全？

### http 不安全

http 协议属于明文传输协议，交互过程以及数据传输都没有进行加密，通信双方也没有进行任何认证，通信过程非常容易遭遇劫持、监听、篡改。

可以把 http 通信比喻成寄送信件一样，A 给 B 寄信，信件在寄送过程中，会经过很多的邮递员之手，他们可以拆开信读取里面的内容（因为 http 是明文传输的）。A 的信件里面的任何内容（包括各类账号和密码）都会被轻易窃取。除此之外，邮递员们还可以伪造或者修改信件的内容，导致 B 接收到的信件内容是假的。

### https 如何保证安全？

https 引入了加密以及身份验证机制。

- 在传输过程中的内容都是经过加密的。
- 引入了证书的概念，保证客户端通信的服务器是真正的服务器，而不是中间人。

在图中可以看到，步骤中间人只可能在 1，3，5，7 时去劫持请求。

- 劫持请求 1 和 3：劫持请求到另一个服务器，或修改服务器返回的证书，都会在步骤 4 中验证证书失败，故攻击失效。
- 劫持请求 5：证书私钥在服务器端，只有服务器端才能解密，中间人没有私钥，故无法破解内容。
- 劫持请求 7：对称加密的密钥存在客户端和服务端，中间人没有密钥，故无法破解内容。

---

::: tip 参考资料
[一个故事讲完 https](https://mp.weixin.qq.com/s/StqqafHePlBkWAPQZg3NrA)
:::
